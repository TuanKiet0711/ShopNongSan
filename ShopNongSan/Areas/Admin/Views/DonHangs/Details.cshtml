@model ShopNongSan.Models.DonHang
@{
    ViewData["Title"] = "Chi tiết đơn " + Model.MaDonHang;

    string BadgeClass(string s)
    {
        return s switch
        {
            "Chờ xử lý" => "status-badge bg-warning text-white",
            "Đã xác nhận" => "status-badge bg-info text-white",
            "Đang giao" => "status-badge bg-primary text-white",
            "Hoàn tất" => "status-badge bg-success text-white",
            "Đã hủy" => "status-badge bg-danger text-white",
            _ => "status-badge bg-secondary text-white"
        };
    }
}

<div class="d-flex align-items-center mb-3 gap-2">
    <h2 class="mb-0 fw-bold text-success">
        <i class="bi bi-receipt"></i> Đơn: @Model.MaDonHang
    </h2>
    <span class="@BadgeClass(Model.TrangThai)">@Model.TrangThai</span>
</div>

<div class="row g-3">
    <!-- THÔNG TIN CHUNG -->
    <div class="col-lg-4">
        <div class="card shadow-sm rounded-4">
            <div class="card-body">
                <h5 class="card-title fw-semibold text-success">
                    <i class="bi bi-person-vcard me-1"></i> Thông tin chung
                </h5>
                <dl class="row mb-0">
                    <dt class="col-5">Mã đơn</dt>
                    <dd class="col-7">@Model.MaDonHang</dd>

                    <dt class="col-5">Người nhận</dt>
                    <dd class="col-7">@(!string.IsNullOrWhiteSpace(Model.HoTen) ? Model.HoTen : (Model.TaiKhoan?.HoTen ?? "-"))</dd>

                    <dt class="col-5">Số điện thoại</dt>
                    <dd class="col-7">@(!string.IsNullOrWhiteSpace(Model.SoDienThoai) ? Model.SoDienThoai : (Model.TaiKhoan?.ThongTinNguoiDung?.SoDienThoai ?? "-"))</dd>

                    <dt class="col-5">Địa chỉ</dt>
                    <dd class="col-7">@(!string.IsNullOrWhiteSpace(Model.DiaChi) ? Model.DiaChi : (Model.TaiKhoan?.ThongTinNguoiDung?.DiaChi ?? "-"))</dd>

                    <dt class="col-5">Ghi chú</dt>
                    <dd class="col-7">@(!string.IsNullOrWhiteSpace(Model.GhiChu) ? Model.GhiChu : "-")</dd>

                    <dt class="col-5">Phương thức TT</dt>
                    <dd class="col-7">
                        @{
                            var pttt = Model.PhuongThucThanhToan ?? Model.TaiKhoan?.ThongTinNguoiDung?.PhuongThucThanhToan;
                            string ptttText = pttt == "BANK" ? "Chuyển khoản" :
                            pttt == "COD" ? "Thanh toán khi nhận (COD)" : "-";
                        }
                        @ptttText
                    </dd>

                    <dt class="col-5">Trạng thái</dt>
                    <dd class="col-7">
                        <span class="@BadgeClass(Model.TrangThai)">@Model.TrangThai</span>
                    </dd>

                    <dt class="col-5">Tổng tiền</dt>
                    <dd class="col-7 fw-semibold text-danger">@Model.TongTien.ToString("N0") đ</dd>

                    <dt class="col-5">Ngày đặt</dt>
                    <dd class="col-7">@Model.NgayDat?.ToString("dd/MM/yyyy HH:mm")</dd>

                    <dt class="col-5">Ngày giao dự kiến</dt>
                    <dd class="col-7">@Model.NgayGiao?.ToString("dd/MM/yyyy")</dd>
                </dl>
            </div>
        </div>
    </div>

    <!-- SẢN PHẨM -->
    <div class="col-lg-8">
        <div class="card shadow-sm rounded-4">
            <div class="card-body">
                <h5 class="card-title fw-semibold text-success">
                    <i class="bi bi-bag-check me-1"></i> Sản phẩm
                </h5>
                <div class="table-responsive">
                    <table class="table table-bordered align-middle text-center mb-0">
                        <thead class="table-success">
                            <tr>
                                <th>Sản phẩm</th>
                                <th>Đơn giá</th>
                                <th>SL</th>
                                <th>Thành tiền</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var ct in Model.DonHangChiTiets)
                            {
                                <tr>
                                    <td>@ct.SanPham?.Ten (@ct.SanPhamId)</td>
                                    <td>@ct.DonGia.ToString("N0") đ</td>
                                    <td>@ct.SoLuong</td>
                                    <td>@((ct.DonGia * ct.SoLuong).ToString("N0")) đ</td>
                                </tr>
                            }
                        </tbody>
                        <tfoot>
                            <tr>
                                <th colspan="3" class="text-end">Tổng cộng</th>
                                <th class="text-end text-danger fw-bold">@Model.TongTien.ToString("N0") đ</th>
                            </tr>
                        </tfoot>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ACTION BAR DƯỚI CÙNG -->
<div class="mt-3 d-flex justify-content-end gap-2">
    <a asp-action="Edit" asp-route-id="@Model.Id" class="btn btn-gradient-green text-white">
        <i class="bi bi-pencil-square me-1"></i> Sửa
    </a>
    <a asp-action="Index" class="btn btn-secondary text-white">
        <i class="bi bi-arrow-left me-1"></i> Quay lại
    </a>
</div>

@section Scripts {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
    <style>
        .table thead.table-success th {
            background: #198754 !important;
            color: #fff !important;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: .875rem;
            font-weight: 700;
            color: #fff !important;
        }

        /* Đồng bộ màu với Index + chữ trắng */
        .bg-warning.text-white {
            background-color: #ffc107 !important;
            color: #fff !important;
        }

        .bg-primary.text-white {
            background-color: #0d6efd !important;
            color: #fff !important;
        }

        .bg-info.text-white {
            background-color: #0dcaf0 !important;
            color: #fff !important;
        }

        .bg-success.text-white {
            background-color: #198754 !important;
            color: #fff !important;
        }

        .bg-danger.text-white {
            background-color: #dc3545 !important;
            color: #fff !important;
        }

        .rounded-4 {
            border-radius: 1rem;
        }

        /* Nút đẹp + chữ trắng */
        .btn-gradient-green {
            background: linear-gradient(45deg,#2e7d32,#43a047);
            border: none;
            color: #fff !important;
            font-weight: 600;
            padding: .55rem 1rem;
            border-radius: .5rem;
            transition: .2s ease-in-out;
        }

            .btn-gradient-green:hover {
                filter: brightness(.95);
                transform: translateY(-1px);
            }

        .btn-secondary.text-white {
            color: #fff !important;
        }
    </style>
}
