@model IEnumerable<TaiKhoan>
@{
    ViewData["Title"] = "Quản lý tài khoản";
    int page = ViewBag.Page ?? 1;
    int totalPages = ViewBag.TotalPages ?? 1;
    int totalCount = ViewBag.TotalCount ?? 0;
    string q = ViewBag.Q as string ?? "";
    string vaiTro = ViewBag.VaiTro as string ?? "";
    var listVT = ViewBag.VaiTroList as List<string>;
}

<h2 class="mb-3">Quản lý tài khoản</h2>

<div class="card shadow-sm mb-3">
    <div class="card-body">
        <form method="get" class="row g-3 align-items-end">
            <div class="col-lg-4">
                <label class="form-label mb-1">Tên đăng nhập / Họ tên</label>
                <input type="text" name="q" value="@q" class="form-control" placeholder="Tìm kiếm..." />
            </div>
            <div class="col-lg-3">
                <label class="form-label mb-1">Vai trò</label>
                <select name="vaiTro" class="form-select">
                    <option value="">-- Tất cả --</option>
                    @foreach (var vt in listVT)
                    {
                        <option value="@vt" selected="@(vaiTro == vt ? "selected" : null)">@vt</option>
                    }
                </select>
            </div>
            <div class="col-lg-2">
                <button type="submit" class="btn btn-primary"><i class="bi bi-funnel"></i> Lọc</button>
            </div>
            <div class="col-lg-3 text-end">
                <a asp-action="Create" class="btn btn-primary"><i class="bi bi-plus-circle"></i> Thêm mới</a>
            </div>
        </form>
    </div>
</div>

<div class="table-responsive shadow-sm rounded">
    <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
            <tr>
                <th>Tên đăng nhập</th>
                <th>Họ tên</th>
                <th>Vai trò</th>
                <th>Mật khẩu</th> @* hiển thị theo yêu cầu *@
                <th>Ngày tạo</th>
                <th style="width:160px" class="text-end">Thao tác</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var tk in Model)
            {
                <tr>
                    <td>@tk.TenDangNhap</td>
                    <td>@tk.HoTen</td>
                    <td>@tk.VaiTro</td>
                    <td>@tk.MatKhau</td> @* plain text *@
                    <td>@tk.NgayTao.ToString("dd/MM/yyyy")</td>
                    <td class="text-end">
                        <div class="btn-group">
                            <a asp-action="Edit" asp-route-id="@tk.Id" class="btn btn-sm btn-warning">Sửa</a>
                            <a asp-action="Delete" asp-route-id="@tk.Id" class="btn btn-sm btn-danger">Xóa</a>
                        </div>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>

@if (totalPages > 1)
{
    <nav class="mt-3">
        <ul class="pagination mb-0">
            <li class="page-item @(page <= 1 ? "disabled" : "")">
                <a class="page-link" asp-action="Index" asp-route-page="@(page-1)" asp-route-q="@q" asp-route-vaiTro="@vaiTro">«</a>
            </li>
            @for (int i = Math.Max(1, page - 2); i <= Math.Min(totalPages, page + 2); i++)
            {
                <li class="page-item @(i == page ? "active" : "")">
                    <a class="page-link" asp-action="Index" asp-route-page="@i" asp-route-q="@q" asp-route-vaiTro="@vaiTro">@i</a>
                </li>
            }
            <li class="page-item @(page >= totalPages ? "disabled" : "")">
                <a class="page-link" asp-action="Index" asp-route-page="@(page+1)" asp-route-q="@q" asp-route-vaiTro="@vaiTro">»</a>
            </li>
        </ul>
    </nav>
}

@section Scripts {
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" />
}
