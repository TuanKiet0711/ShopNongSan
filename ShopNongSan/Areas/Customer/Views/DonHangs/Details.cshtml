@model ShopNongSan.Models.DonHang
@{
    ViewData["Title"] = "Chi tiết đơn " + Model.MaDonHang;
}
<h2 class="mb-3">Đơn: @Model.MaDonHang</h2>

<p><b>Trạng thái:</b> @Model.TrangThai</p>

@{
    var pttt = ViewBag.PhuongThucThanhToan as string ?? TempData["pttt"] as string;
    if (!string.IsNullOrEmpty(pttt))
    {
        <p><b>Phương thức thanh toán:</b> @(pttt == "BANK" ? "Chuyển khoản" : "Thanh toán khi nhận")</p>
    }
}

@if (string.Equals(Model.TrangThai, "Pending", StringComparison.OrdinalIgnoreCase))
{
    <form asp-action="Cancel" method="post" class="mb-3 d-inline"
          onsubmit="return confirm('Bạn chắc muốn hủy đơn này?')">
        @Html.AntiForgeryToken()
        <input type="hidden" name="id" value="@Model.Id" />
        <button type="submit" class="btn btn-danger">Hủy đơn</button>
    </form>
}

<table class="table table-bordered align-middle">
    <thead>
        <tr>
            <th>Sản phẩm</th>
            <th class="text-end">Đơn giá</th>
            <th class="text-center">SL</th>
            <th class="text-end">Thành tiền</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var ct in Model.DonHangChiTiets)
        {
            <tr>
                <td>@ct.SanPham?.Ten</td>
                <td class="text-end">@ct.DonGia.ToString("N0") đ</td>
                <td class="text-center">@ct.SoLuong</td>
                <td class="text-end">@((ct.DonGia * ct.SoLuong).ToString("N0")) đ</td>
            </tr>
        }
    </tbody>
    <tfoot>
        <tr>
            <th colspan="3" class="text-end">Tổng cộng</th>
            <th class="text-end">@Model.TongTien.ToString("N0") đ</th>
        </tr>
    </tfoot>
</table>

<a asp-action="Index" class="btn btn-outline-secondary">Quay lại danh sách</a>
